The code for this problem is too long to include here. Please refer to the LeetCode URL for the optimal Python code.